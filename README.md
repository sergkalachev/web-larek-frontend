# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных и типов данных проекта
Исходя из макета и данных в Json можно описать данные следующим образом:

Продукт
```
interface Product {
    id: string;
    description: string;
    image: string;
    title: string;
    category: category;
    price: number | null;
} 
```

Заказ
```
interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number | null;
	items: string[];
}
```

Категории продукта
```
enum EProductCategory {
	'софт-скил' = 'soft',
	'хард-скил' = 'hard',
	'другое' = 'other',
	'дополнительное' = 'additional',
	'кнопка' = 'button',
}
```

 ### Архитектура приложения

 Логика приложения выстроена на архитектуре MVP
 - Model - содержит логику отображения товаров, расчета стоимости всех продуктов в корзине, валидации данных в заказе и тд
 - View - классы отображения основных элементов приложения, таких как карточки товара, корзина, заказ
 - Presenter - отвечает за связь представления и данных.

 ### Базовый код

 #### Класс EventEmitter

 Класс содержит классическую реализацию EventEmitter (брокера событий) с рядом возможностей для работы с событиями, такими как подписка, генерация и триггеринг событий. 
 Основная цель — отделить компоненты приложения, предоставляя механизм для их взаимодействия через события.

 Методы:
- `on` — подписывает обработчик на событие;
- `emit` — генерирует событие с передачей данных подписчикам.;
- `trigger` - создаёт обработчик, который автоматически будет генерировать событие с определённым контекстом при вызове.

#### Класс Api

Класс предоставляет методы для выполнения HTTP-запросов к серверу, таких как получение данных, отправка и обновление информации.
Класс содержит базовый URL, на который будут направляться все запросы + настройки для каждого запроса, включая заголовки (по умолчанию используется Content-Type: application/json).

Методы:
- `handleResponse` — Обрабатывает ответ от сервера. Если запрос успешен, возвращает распарсенный JSON-ответ. В случае ошибки — отклоняет промис с сообщением об ошибке. 
- `get` - Выполняет GET-запрос по указанному URI, используя базовый URL и настройки запроса. Возвращает промис с результатом.
- `post` -  Выполняет запрос на указанный URI с переданными данными. Возвращает промис с результатом.

#### Класс Component

Это абстрактный базовый класс, используемый для создания компонентов на основе DOM. Класс является родителем всех компонентов слоя представления.
Он предоставляет набор методов для управления элементами интерфейса и взаимодействия с DOM.

Методы:
- `toggleClass` — позволяет добавить или удалить CSS-класс у элемента;
- `setText` - устанавливает текстовое содержимое для указанного элемента;
- `setDisabled` - включает или отключает элемент, изменяя его атрибут disabled;
- `setHidden` - cкрывает элемент, изменяя его CSS-свойство display на none;
- `setImage` - устанавливает изображение для элемента <img>;
- `render` - Возвращает корневой DOM-элемент компонента. Данный метод может принимать объект data, который будет применён к экземпляру класса с использованием Object.assign.

#### Класс Model

Класс Model является абстрактным, и предназначен для использования в качестве основы для более конкретных моделей данных.
Метод emitChanges используется для оповещения системы об изменениях в модели, что позволяет интеграции с другими частями приложения, реагирующими на эти изменения.

### Слой данных (Model)

#### Класс ProductModel

Класс, который наследует Model и представляет один продукт:

Поля:
- `id` -  уникальный идентификатор продукта;
- `description` - описание продукта;
- `image` - URL изображения продукта;
- `title` - название продукта;
- `category` - категория продукта, выбранная из заранее предопределенного списка;
- `price` - цена продукта. Может быть null, если цена не указана;
- `buttonState` - объект, представляющий состояние кнопки (например, добавлен ли продукт в корзину);
- `index` - индекс продукта в каталоге.

Метод:
- `getStateIsNull` - проверяет, не указана ли цена (возвращает true, если цена null).

#### Класс AppModel

Управляет всей бизнес-логикой приложения, включая каталог, корзину и заказы.

Поля:
- `catalog` - cписок продуктов, каждый из которых представлен объектом ProductModel;
- `basket` - корзина с продуктами;
- `order` - заказ, включающий поля оплаты, контактную информацию и товары;
- `formErrors` - объект ошибок формы.

Методы:
- `setCatalog` - заполняет каталог продуктами и генерирует событие добавления карт;
- `getInBasket` - проверяет, находится ли продукт в корзине;
- `addToBasket` - добавляет продукт в корзину, если его там нет;
- `removeFromBasket` - удаляет продукт из корзины;
- `clearBasket` - очищает корзину;
- `clearOrder` -  очищает данные заказа;
- `setOrderField` - устанавливает значение для указанного поля формы заказа и проверяет, валидна ли форма;
- `getTotal` - рассчитывает общую сумму товаров в корзине;
- `validateOrder` - проверяет корректность email и телефона в заказе, обновляет ошибки формы;
- `validateContacts` - Проверяет корректность адреса и способа оплаты, обновляет ошибки формы.

### Слой представления (View)

#### Класс Modal

Класс отвечает за отображение, скрытие и управление содержимым модального окна, а также за генерацию событий при открытии или закрытии модального окна.
Конструктор принимает контейнер модального окна и объект событий.
Внутри конструктора определяется содержимое модального окна и кнопка закрытия, через `ensureElement`.
Устанавливаются обработчики событий для закрытия окна по клику на контейнер или кнопку закрытия.

Методы:
- `set content` - сеттер для установки содержимого модального окна;
- `open` - метод для открытия модального окна. Добавляет класс modal_active к контейнеру и инициирует событие modal:open;
- `close` - метод для закрытия модального окна. Убирает класс modal_active и инициирует событие modal:close;
- `render` - метод для отрисовки контента модального окна и его последующего открытия. Вызывает метод родительского класса для отрисовки и возвращает контейнер.

#### Класс  Form

Этот класс расширяет базовый класс Component и реализует функциональность для управления формами, их валидацией, отображением ошибок и взаимодействием с событиями.
Интерфейс `IForm` наследуется от `IOrderForm` и добавляет два новых свойства:
- `valid` - указывает валидна ли форма
- `formErrors` - массив ошибок валидации

Поля:
- `_formErrors` - элемент DOM, отвечающий за отображение ошибок в форме;
- `_submitButton` - кнопка отправки формы

Методы:
- `onInputChanged` - вызывается при изменении любого поля формы и эмитирует событие изменения поля с его именем и новым значением;
- `set valid` - управляет доступностью кнопки отправки в зависимости от валидности формы;
- `set formErrors` - устанавливает текст ошибок в блоке ошибок формы;
- `render` - метод для рендеринга формы на основе переданного состояния

#### Класс Page

Класс Page наследуется от базового класса Component<IPage> и представляет собой компонент для управления различными элементами страницы, такими как галерея, счётчик корзины, блокировка страницы и кнопка корзины.

Поля:
- `_gallery` - элемент галереи товаров на главной странице
- `_counter` - количество товаров в корзине
- `_lockedWrapper` - обертка страницы которую можно блокировать, например, добавляя специальный класс
- `basketButton` - кнопка открытия корзины

Конструктор на входе получает корневой контейнер в котором находятся элементы страницы и события
При инициализации в конструкторе происходит поиск и привязка всех элементов страницы и назначается обработчик события для кнопки корзины через генерацию события basket:open

Методы:
- `counter` - устанавливает значение счетчика корзины
- `gallery` - устанавливает новый набор элементов для галереи
- `locked` - управляет блокировкой обертки страницы

#### Класс Card

Класс для отображения карточек товаров

Поля:
- `cardTitle` - заголовок карточки
- `cardPrice` - стоимость товара
- `cardButton` - кнопка добавления товара в корзину

Методы:
- `set title` - устанавливает заголовок карточки
- `set price` - устанавливает стоимость продукта
- `set id` - устанавливает и возвращает идентификатор

#### Класс CardCatalog 

Расширяет базовый класс Card, инициализирует изображение, категорию и настраивает обработчики кликов по карточке. Включает два дополнительных поля:
- `cardImage` - элемент отображения товара
- `cardCategory` - элемент отображения категории товара

Методы
- `set image` - устанавливает изображение товара
- `set category` - для отображения категории товара

#### Класс CardPreview

Расширяет класс CardCatalog и содержит дополнительное поле `cardDescription` для вывода информации с описанием товара

Методы:
- `set description` - устанавливает текст с описанием товара
- `buttonState` - управляет состоянием кнопки добавления в корзину

#### Класс CardBasket

Класс для отображения карточки товара в корзине, расширяет базовый класс Card. Класс содержит дополнительное поле cardIndex для отображения порядкового номера товара в корзине. Сеттер index устанавливает порядковый номер товара в корзине.

#### Класс Basket

Класс Basket реализует компонент корзины, который отображает список товаров и общую сумму. 
Этот компонент также поддерживает возможность обработки действий, связанных с корзиной, таких как нажатие кнопки для совершения покупки.

Интерфейсы:
IBasketActions - определяет действия, связанные с корзиной
- `onClick` - функция, которая вызывается при клике на кнопку корзины
IBasket - определяет структуру корзины
- `items` - массив элементов в корзине
- `total` - общая стоимость элементов в корзине

Конструктор принимает корневой элемент контейнера корзины и обработчик клика
Внутри конструктора происходит поиск и назначение элементов корзины и назначается обработчик на кнопку корзины

Методы:
-`disabledButton` - включает или отключает кнопку действия корзины в зависимости от переданного параметра valid. Если значение true, кнопка будет отключена;
-`set items` - Если передан массив элементов корзины, то они будут заменены в списке корзины, и кнопка действия включается.
Если массив пуст, корзина отображает сообщение "Корзина пуста"
- `set total` - обновляет общую стоимость товаров в корзине и выводит результат с добавлением валюты
- `render` - принимает объект типа IBasket. Если объект не передан, возвращается контейнер корзины. 
Если данные присутствуют, вызывается базовый метод render, который обновляет список товаров и общую сумму.

#### Класс Contacts

Класс Contacts предназначен для управления контактной информацией пользователя, такой как электронная почта и номер телефона.

#### Класс Order
Класс Order расширяет базовый класс формы Form и предназначен для работы с формой оформления заказа. В нём реализована логика управления выбором способа оплаты и заполнения адреса доставки.

#### Класс Success
Класс Success отвечает за отображение страницы успешного оформления заказа.

### Слой представления

Роль презентора в приложении выполняет файл index.ts Взаимодействие между слоем логики и слоем отображения происходит за счет событий генерируемых с помощью инициации событий и обработчиков этих событий

Список событий:

- `gallery:changed` — изменились элементы галереи (продукты), происходит установка новых данных в модель, и на их сновании отрисовка карточек в галерее;
- `preview:select` — выбрана карточка, ее данные записаны в модель; 
- `modal:open` — модальное окно открыто, главная страница блокируется;
- `modal:close` — модальное окно закрыто, снимается блокировка с главной страницы;
- `product:add-to-basket` - продукт добавлен в корзину;
- `product:delete-from-basket` - продукт удален из корзины;
- `basket:open` — корзина открыта;
- `basket:changed` — изменились элементы корзины, происходит получение новых данных об элементах из модели, на их основании отрисовываются новые элементы корзины;
- `order:open` — открыта форма заказа, в модальном окне отрисовывается форма заказа;
- `order:submit` — форма заказа готова и валидна, в модальном окне отрисовывается форма контактов;
- `contacts:submit` - заказ корректно заполнен;
- `order:ready` - заказ готов;
- `order:clean` - заказ очищен.