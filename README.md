# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
 ### Архитектура приложения

 Логика приложения выстроена на архитектуре MVP
 - Model - содержит логику отображения товаров, расчета стоимости всех продуктов в корзине, валидации данных в заказе и тд
 - View - классы отображения основных элементов приложения, таких как карточки товара, корзина, заказ
 - Presenter - отвечает за связь представления и данных.

 ### Базовый код

 #### Класс EventEmitter

 Класс содержит классическую реализацию EventEmitter (брокера событий) с рядом возможностей для работы с событиями, такими как подписка, генерация и триггеринг событий. 
 Основная цель — отделить компоненты приложения, предоставляя механизм для их взаимодействия через события.

 Методы:
- `on` — подписывает обработчик на событие;
- `emit` — генерирует событие с передачей данных подписчикам.;
- `trigger` - создаёт обработчик, который автоматически будет генерировать событие с определённым контекстом при вызове.

#### Класс Api

Класс предоставляет методы для выполнения HTTP-запросов к серверу, таких как получение данных, отправка и обновление информации.
Класс содержит базовый URL, на который будут направляться все запросы + настройки для каждого запроса, включая заголовки (по умолчанию используется Content-Type: application/json).

Методы:
- `handleResponse` — Обрабатывает ответ от сервера. Если запрос успешен, возвращает распарсенный JSON-ответ. В случае ошибки — отклоняет промис с сообщением об ошибке. 
- `get` - Выполняет GET-запрос по указанному URI, используя базовый URL и настройки запроса. Возвращает промис с результатом.
- `post` -  Выполняет запрос на указанный URI с переданными данными. Возвращает промис с результатом.

#### Класс Component

Это абстрактный базовый класс, используемый для создания компонентов на основе DOM. Класс является родителем всех компонентов слоя представления.
Он предоставляет набор методов для управления элементами интерфейса и взаимодействия с DOM.

Методы:
- `toggleClass` — позволяет добавить или удалить CSS-класс у элемента;
- `setText` - устанавливает текстовое содержимое для указанного элемента;
- `setDisabled` - включает или отключает элемент, изменяя его атрибут disabled;
- `setHidden` - cкрывает элемент, изменяя его CSS-свойство display на none;
- `setImage` - устанавливает изображение для элемента <img>;
- `render` - Возвращает корневой DOM-элемент компонента. Данный метод может принимать объект data, который будет применён к экземпляру класса с использованием Object.assign.

#### Класс Model

Класс Model является абстрактным, и предназначен для использования в качестве основы для более конкретных моделей данных.
Метод emitChanges используется для оповещения системы об изменениях в модели, что позволяет интеграции с другими частями приложения, реагирующими на эти изменения.

### Слой данных (Model)

#### Класс ProductItem

Класс, который наследует Model и представляет один продукт:

Поля:
- `id` -  уникальный идентификатор продукта;
- `description` - описание продукта;
- `image` - URL изображения продукта;
- `title` - название продукта;
- `category` - категория продукта, выбранная из заранее предопределенного списка;
- `price` - цена продукта. Может быть null, если цена не указана;
- `productInBasket` - определяет состояние наличия товара в корзине

#### Класс AppState

Управляет всей бизнес-логикой приложения, включая каталог, корзину и заказы.

Поля:
- `catalog` - cписок продуктов, каждый из которых представлен объектом ProductModel;
- `basket` - корзина с продуктами;
- `order` - заказ, включающий поля оплаты, контактную информацию и товары;
- `formErrors` - объект ошибок формы.

Методы:
- `setCatalog` - заполняет каталог продуктами и генерирует событие добавления карт;
- `setPreview` - отвечает за открытие предпросмотра товара
- `getProductsInBasket` - возвращает товары которые лежат в корзине
- `addToBasket` - добавляет продукт в корзину, если его там нет;
- `removeFromBasket` - удаляет продукт из корзины;
- `clearBasket` - очищает корзину;
- `setOrderField` - устанавливает значение для указанного поля формы заказа и проверяет, валидна ли форма;
- `setContactField` - устанавливает значение для указанного поля формы заполнения контактной информации и проверяет, валидна ли форма;
- `getTotalPrice` - рассчитывает общую сумму товаров в корзине;
- `validateContactsForm` - проверяет корректность email и телефона в заказе, обновляет ошибки формы;
- `validateOrderForm` - Проверяет корректность адреса и способа оплаты, обновляет ошибки формы
- `getOrder` - возвращает данные по продуктам в корзине и общей стоимости заказа

### Слой представления (View)

#### Класс Modal

Класс отвечает за отображение, скрытие и управление содержимым модального окна, а также за генерацию событий при открытии или закрытии модального окна.
Конструктор принимает контейнер модального окна и объект событий.
Внутри конструктора определяется содержимое модального окна и кнопка закрытия, через `ensureElement`.
Устанавливаются обработчики событий для закрытия окна по клику на контейнер или кнопку закрытия.

Методы:
- `set content` - сеттер для установки содержимого модального окна;
- `open` - метод для открытия модального окна. Добавляет класс modal_active к контейнеру и инициирует событие modal:open;
- `close` - метод для закрытия модального окна. Убирает класс modal_active и инициирует событие modal:close;
- `render` - метод для отрисовки контента модального окна и его последующего открытия. Вызывает метод родительского класса для отрисовки и возвращает контейнер.

#### Класс  Form

Этот класс расширяет базовый класс Component и реализует функциональность для управления формами, их валидацией, отображением ошибок и взаимодействием с событиями.
Интерфейс `IForm` наследуется от `IOrderForm` и добавляет два новых свойства:
- `valid` - указывает валидна ли форма
- `formErrors` - массив ошибок валидации

Поля:
- `_formErrors` - элемент DOM, отвечающий за отображение ошибок в форме;
- `_submitButton` - кнопка отправки формы

Методы:
- `onInputChanged` - вызывается при изменении любого поля формы и эмитирует событие изменения поля с его именем и новым значением;
- `set valid` - управляет доступностью кнопки отправки в зависимости от валидности формы;
- `set formErrors` - устанавливает текст ошибок в блоке ошибок формы;
- `render` - метод для рендеринга формы на основе переданного состояния

#### Класс Page

Класс Page наследуется от базового класса Component<IPage> и представляет собой компонент для управления различными элементами страницы, такими как галерея, счётчик корзины, блокировка страницы и кнопка корзины.

Поля:
- `_catalog` - элемент галереи товаров на главной странице
- `_counter` - количество товаров в корзине
- `_wrapper` - обертка страницы которую можно блокировать, например, добавляя специальный класс
- `basketButton` - кнопка открытия корзины

Конструктор на входе получает корневой контейнер в котором находятся элементы страницы и события
При инициализации в конструкторе происходит поиск и привязка всех элементов страницы и назначается обработчик события для кнопки корзины через генерацию события basket:open

Методы:
- `counter` - устанавливает значение счетчика корзины
- `catalog` - устанавливает новый набор элементов для галереи
- `locked` - управляет блокировкой обертки страницы

#### Класс Card

Класс для отображения карточек товаров

Поля:
- `_title` - заголовок карточки
- `_image` - сссылка на картинку с карточкой товара (не обязательное поле)
- `_description` - описание товара (не обязательное поле)
- `_category` - категория товара (не обязательное поле)
- `_price` - стоимость товара
- `_button` - кнопка добавления товара в корзину

Сеттеры:
- `set title` - устанавливает заголовок карточки
- `set description` - устанавливает описание продукта
- `set image` - устанавливает картинку продукта
- `set price` - устанавливает стоимость продукта и проверяет есть ли у продукта стоимость или он бесценный
- `set previewButtonName` - определяет лейбл кнопки добавления товара в корзину в зависимости от того был ли товар добавлен ранее или нет
- `set category` - устанавливает категорию продукта на главной странице


#### Класс CardInBasket

Класс для отображения карточки товара в корзине, расширяет базовый класс Card. Класс содержит дополнительное поле ]`_basketItemIndex` для отображения порядкового номера товара в корзине. 

#### Класс Basket

Класс Basket реализует компонент корзины, который отображает список товаров и общую сумму. 

Поля:
- `_list` - контейнер для товаров в корзине
- `_total` - контейнер для отображения итоговой стоимости
- `_button` - кнопка добавления заказа

Сеттеры

- `set items` - отображает содержимое контейнера list или выводит текст о том что Корзина пуста
- `set items` - устанавливает итоговую стоимость товаров

#### Класс Contacts

Класс Contacts предназначен для управления контактной информацией пользователя, такой как электронная почта и номер телефона.

#### Класс Order
Класс Order расширяет базовый класс формы Form и предназначен для работы с формой оформления заказа. В нём реализована логика управления выбором способа оплаты и заполнения адреса доставки.

#### Класс Success
Класс Success отвечает за отображение страницы успешного оформления заказа и итоговой стоимости

### Слой представления

Роль презентора в приложении выполняет файл index.ts Взаимодействие между слоем логики и слоем отображения происходит за счет событий генерируемых с помощью инициации событий и обработчиков этих событий

Список событий:

- `items:changed` — изменились элементы галереи (продукты), происходит установка новых данных в модель, и на их сновании отрисовка карточек в галерее;
- `card:select` — выбрана карточка, данные пишем в модель; 
- `preview:changed` — событие для отрисовки модального окна с детальной информацией о товаре
- `basket:open` — событие открытия корзины
- `basket:changed` — событие о том что товары в корзине изменились и нужно повторно отрисовать данные
- `basket:open` — событие открытия заказа
- `modal:open` — модальное окно открыто, выставляем блокировку прокрутки главной страницы
- `modal:close` — модальное окно закрыто, снимаем блокировку прокрутки главной страницы
- `formOrderErrors:change` — событие о том что изменилось состояние валидации формы заказа
- `formContactsErrors:change` — событие о том что изменилось состояние валидации формы контактной информации
- `order:submit` - события сабмита формы заказа
- `order.payment:change` - событие смены способа оплаты заказа
- `contacts:submit` - события сабмита формы запроверки контактных данныхказа